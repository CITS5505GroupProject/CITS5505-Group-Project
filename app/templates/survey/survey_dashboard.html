{% extends "navbar/navbar.html" %}
{% block title %} Survey Dashboard {% endblock %}
{% set visible=True %}
{% block content %}
<div class="container mt-3">
    <!-- Search Bar -->
    <div class="mb-3">
        <input type="text" class="form-control" id="searchInput" onkeyup="searchItems()" placeholder="Search for survey title..." aria-label="Search">
    </div>
    <div id="filter-options" class="container">
        <div class="row row-cols-2 row-cols-md-5 g-2">
            <div class="col">
                <input type="checkbox" class="btn-check filter-type" id="btn-check-education" autocomplete="off" value="education">
                <label class="btn btn-outline-primary w-100" for="btn-check-education">Education</label>
            </div>
            <div class="col">
                <input type="checkbox" class="btn-check filter-type" id="btn-check-business" autocomplete="off" value="business">
                <label class="btn btn-outline-primary w-100" for="btn-check-business">Business</label>
            </div>
            <div class="col">
                <input type="checkbox" class="btn-check filter-type" id="btn-check-healthcare" autocomplete="off" value="healthcare">
                <label class="btn btn-outline-primary w-100" for="btn-check-healthcare">Healthcare</label>
            </div>
            <div class="col">
                <input type="checkbox" class="btn-check filter-type" id="btn-check-technology" autocomplete="off" value="technology">
                <label class="btn btn-outline-primary w-100" for="btn-check-technology">Technology</label>
            </div>
            <div class="col">
                <input type="checkbox" class="btn-check filter-type" id="btn-check-entertainment" autocomplete="off" value="entertainment">
                <label class="btn btn-outline-primary w-100" for="btn-check-entertainment">Entertainment</label>
            </div>
            <div class="col">
                <input type="checkbox" class="btn-check filter-type" id="btn-check-social" autocomplete="off" value="social">
                <label class="btn btn-outline-primary w-100" for="btn-check-social">Social</label>
            </div>
            <div class="col">
                <input type="checkbox" class="btn-check filter-type" id="btn-check-politics" autocomplete="off" value="politics">
                <label class="btn btn-outline-primary w-100" for="btn-check-politics">Politics</label>
            </div>
            <div class="col">
                <input type="checkbox" class="btn-check filter-type" id="btn-check-science" autocomplete="off" value="science">
                <label class="btn btn-outline-primary w-100" for="btn-check-science">Science</label>
            </div>
            <div class="col">
                <input type="checkbox" class="btn-check filter-type" id="btn-check-environment" autocomplete="off" value="environment">
                <label class="btn btn-outline-primary w-100" for="btn-check-environment">Environment</label>
            </div>
            <div class="col">
                <input type="checkbox" class="btn-check filter-type" id="btn-check-personal_development" autocomplete="off" value="personal_development">
                <label class="btn btn-outline-primary w-100" for="btn-check-personal_development">Self-Improvement</label>
            </div>
        </div>
    </div>
    
</div>
    
    
<!-- Content Containers -->
<div class="container mt-3">
    <div class="row" id="survey-list"></div>
</div>

<script>
// Example data, replace with actual data passed from the backend
var surveys = {{ surveys|tojson | safe }};
const surveyList = document.getElementById('survey-list');

function displaySurveys() {
    surveyList.innerHTML = ''; // Clear current surveys
    surveys.forEach(survey => {
        if (isActiveSurvey(survey) && matchesSearch(survey)) { // Check if the survey should be shown
            const div = document.createElement('div');
            div.className = 'col-12 col-md-4 survey-item'; // Bootstrap classes for responsiveness
            div.setAttribute('data-type', survey.type);
            div.innerHTML = `
                <div class="card mb-4">
                    <div class="card-header">
                        <div class="d-flex align-items-center">
                            <img src="static/${survey.creator.profilePic}" class="rounded-circle me-2" width="40" height="40" alt="User">
                            <div>
                                <h6 class="mb-0">${survey.creator.username}</h6>
                                <small class="text-muted">Created at: ${survey.created_at}</small>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <p><strong>${survey.title}</strong></p>
                        <p class="card-text">${survey.description}</p>
                    </div>
                    <div class="card-footer d-flex justify-content-between align-items-center">
                        <a class="btn btn-info" href="/take-survey/${survey.id}">Answer</a> 
                    </div>
                </div>
            `;
            surveyList.appendChild(div);
        }
    });
}

function isActiveSurvey(survey) {
    const checkedTypes = Array.from(document.querySelectorAll('.filter-type:checked')).map(el => el.value);
    return checkedTypes.length === 0 || checkedTypes.includes(survey.type);
}

function matchesSearch(survey) {
    const searchInput = document.getElementById('searchInput').value.toLowerCase();
    return (
        survey.title.toLowerCase().includes(searchInput) ||
        survey.description.toLowerCase().includes(searchInput) ||
        survey.creator.username.toLowerCase().includes(searchInput)
    );
}

function searchItems() {
    displaySurveys(); // Update display on search input
}

displaySurveys(); // Initial display

document.querySelectorAll('.filter-type').forEach(input => {
    input.addEventListener('change', displaySurveys); // Update display on filter change
});
</script>
{% endblock %}

<!-- {% block extra_js %}
<script src="{{ url_for('static', filename='js/survey_dashboard.js') }}"></script>
{% endblock %} -->